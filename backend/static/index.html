<!DOCTYPE html>
<html>
  <head>
    <title>Draw Road Segments on Google Maps</title>
    <style>
      /* Make sure the map div fills the page */
      #map {
        height: 100%;
        width: 100%;
      }
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <!-- Include the Google Maps JavaScript API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCs97m45Iq2GHeGEqSkh39zuFaye3rn8n4"></script>
    <script>
      async function initMap() {
        // Create the map centered roughly on the road's area.
        var map = new google.maps.Map(document.getElementById("map"), {
          zoom: 15,
          center: { lat: -37.8689243, lng: 144.9755534 },
        });

        // Fetch road data from the API
        let response = await fetch(window.location.origin + "/get-cameras");
        let cameraData = await response.json();
        console.log(cameraData)

        if (!cameraData || cameraData.length === 0) {
          console.error("No roads data received from API.");
          return;
        }

        /*
          [{
            "id": row[0],
            "camera_type": row[1],
            "points": row[2],
            "road": row[3],
            "suburb": row[4]
        } ...]
        */

        
        
        for (let camera of cameraData) {
          console.log(camera)
          var lines = JSON.parse(camera.points)
          
          lines.forEach(segment => {
            console.log(segment);
            // Create a polyline for the road and set its path
            var roadPolyline = new google.maps.Polyline({
              path: segment,
              geodesic: true, // Whether to use geodesic (curved) lines
              strokeColor: "#FF0000",
              strokeOpacity: 1.0,
              strokeWeight: 3
            });

            // Display the polyline on the map
            roadPolyline.setMap(map);
          })
        }
    }
    </script>
  </head>
  <body onload="initMap()">
    <div id="map"></div>
  </body>
</html>
